<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ë‹¨ì–´ì¥ (ì‹¬í”Œ ë²„ì „)</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f0f2f5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ë°” - ë¬¸ì¥ê³µë¶€ ì‚­ì œë¡œ 2ì¹¸ìœ¼ë¡œ ì¡°ì • */
        nav { background: white; padding: 15px 5px; display: flex; justify-content: space-around; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .nav-item { font-weight: bold; color: #aaa; cursor: pointer; padding: 5px 10px; font-size: 14px; flex: 1; text-align: center; }
        .nav-item.active { color: black; border-bottom: 2px solid black; }
        
        .container { flex: 1; padding: 20px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        .screen { width: 100%; max-width: 450px; display: none; } 
        .screen.active { display: block; } 

        /* ê³µí†µ UI ìš”ì†Œ */
        .status-box { background: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .input-area { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;}
        input { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .add-btn { background: black; color: white; width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; }
        
        /* ì¹´ë“œ ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ */
        .list-title { margin: 20px 0 10px 0; font-weight: bold; color: #555; display: flex; justify-content: space-between; align-items: center; }
        .card-item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card-info { text-align: left; width: 70%; }
        .card-front { font-weight: bold; font-size: 16px; color: #333; margin-bottom: 5px; }
        .card-back { font-size: 14px; color: #888; }
        .del-btn { background: #ff4d4d; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold; }

        /* ë‹¨ì–´ ê³µë¶€ ì¹´ë“œ */
        .card { background: white; border-radius: 20px; padding: 40px 20px; min-height: 300px; width: 100%; box-shadow: 0 10px 25px rgba(0,0,0,0.1); cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; margin-bottom: 20px; }
        .front { font-size: 30px; font-weight: bold; color: #333; }
        .back { font-size: 24px; color: #007bff; margin-top: 30px; font-weight: bold; }
        .btn-group { display: flex; gap: 10px; width: 100%; }
        .btn-group button { flex: 1; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 14px; }
        
        /* ë¡œë”© í™”ë©´ */
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:999; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 20px; color: #333; }
    </style>
</head>
<body>

    <div id="loading">ì„œë²„ ì—°ê²° ì¤‘...</div>

    <nav>
        <div id="tab-manage" class="nav-item active" onclick="ui.switchTab('manage')">ì¹´ë“œê´€ë¦¬</div>
        <div id="tab-study" class="nav-item" onclick="ui.switchTab('study')">ë‹¨ì–´ê³µë¶€</div>
    </nav>

    <div class="container">
        <div id="view-manage" class="screen active">
            <div class="status-box">
                <span style="font-size:14px; color:#666;">ì˜¤ëŠ˜ ë³µìŠµ:</span> 
                <span id="due-count" style="font-weight:bold; color:#007bff; font-size:18px;">0</span>ê°œ
                <span style="margin: 0 10px; color:#ddd;">|</span>
                <span id="total-count" style="font-weight:bold; font-size:18px;">0</span>ê°œ ì €ì¥ë¨
            </div>
            <div class="input-area">
                <h3 style="margin-top:0; font-size:18px;">ìƒˆ ì¹´ë“œ ì¶”ê°€</h3>
                <input type="text" id="new-front" placeholder="ì•ë©´ (ì˜ì–´)">
                <input type="text" id="new-back" placeholder="ë’·ë©´ (í•œê¸€)">
                <button class="add-btn" onclick="logic.addCard()">ì €ì¥í•˜ê¸°</button>
            </div>
            <div class="list-title"><span>ì„œë²„ ì €ì¥ ëª©ë¡</span> <button onclick="logic.loadCards()" style="background:none; border:none; color:blue; cursor:pointer;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button></div>
            <div id="card-list-area"></div>
        </div>

        <div id="view-study" class="screen">
            <div id="study-content" style="display:none; width:100%;">
                <div id="card-display" class="card" onclick="ui.flipCard()">
                    <div id="card-text">ë¡œë”© ì¤‘...</div>
                </div>
                <p id="guide-text" style="color:#888; text-align:center;">í„°ì¹˜í•´ì„œ ì •ë‹µ í™•ì¸</p>
                <div id="rating-btns" class="btn-group" style="display: none;">
                    <button style="background:#ffadad" onclick="logic.rateCard(1)">Again</button>
                    <button style="background:#ffd6a5" onclick="logic.rateCard(3)">Hard</button>
                    <button style="background:#fdffb6" onclick="logic.rateCard(4)">Good</button>
                    <button style="background:#caffbf" onclick="logic.rateCard(5)">Easy</button>
                </div>
            </div>
            <div id="no-study" style="text-align: center; display: block;">
                <h2>ğŸ‰</h2><h3>ê³µë¶€ ë!</h3><p>ë³µìŠµí•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <button class="add-btn" onclick="ui.switchTab('manage')">ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBaf_WMp-HO061x8di3e2Z_bFrSytngQGA",
            authDomain: "anki-27849.firebaseapp.com",
            projectId: "anki-27849",
            storageBucket: "anki-27849.firebasestorage.app",
            messagingSenderId: "3948908398",
            appId: "1:3948908398:web:65ee16620c4caee6d03b7f",
            measurementId: "G-19J7ZJVV0S"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const DOC_ID = "my_cards_data";

        let cards = [];
        let currentCard = null;

        window.ui = {
            switchTab: (tabName) => {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
                document.getElementById(`tab-${tabName}`).classList.add('active');
                document.getElementById(`view-${tabName}`).classList.add('active');
                
                if (tabName === 'study') logic.prepareStudy();
            },
            flipCard: () => {
                if (!currentCard) return;
                document.getElementById('card-text').innerHTML = `<div class="front">${currentCard.front}</div><div class="back">${currentCard.back}</div>`;
                document.getElementById('rating-btns').style.display = 'flex';
                document.getElementById('guide-text').style.display = 'none';
            }
        };

        window.logic = {
            loadCards: async () => {
                document.getElementById('loading').style.display = 'flex';
                try {
                    const docRef = doc(db, "anki", DOC_ID);
                    const docSnap = await getDoc(docRef);
                    cards = docSnap.exists() ? (docSnap.data().list || []) : [];
                    ui.renderList();
                    ui.updateStats();
                } catch (e) {
                    alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: " + e.message);
                }
                document.getElementById('loading').style.display = 'none';
            },

            saveToDB: async () => {
                document.getElementById('loading').style.display = 'flex';
                await setDoc(doc(db, "anki", DOC_ID), { list: cards });
                ui.updateStats();
                document.getElementById('loading').style.display = 'none';
            },

            addCard: async () => {
                const front = document.getElementById('new-front').value;
                const back = document.getElementById('new-back').value;
                if (!front || !back) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”');

                const newCard = {
                    id: Date.now(),
                    front: front, back: back,
                    interval: 0, repetitions: 0, easeFactor: 2.5,
                    nextReview: new Date().toISOString().split('T')[0]
                };
                cards.push(newCard);
                await logic.saveToDB();
                
                document.getElementById('new-front').value = '';
                document.getElementById('new-back').value = '';
                ui.renderList();
                alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            },

            deleteCard: async (id) => {
                if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    cards = cards.filter(c => c.id !== id);
                    await logic.saveToDB();
                    ui.renderList();
                }
            },

            rateCard: async (quality) => {
                let { interval, repetitions, easeFactor } = currentCard;
                if (quality >= 3) {
                    if (repetitions === 0) interval = 1;
                    else if (repetitions === 1) interval = 6;
                    else interval = Math.round(interval * easeFactor);
                    repetitions++;
                } else {
                    repetitions = 0;
                    interval = 1;
                }
                easeFactor += (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                if (easeFactor < 1.3) easeFactor = 1.3;

                const nextDate = new Date();
                nextDate.setDate(nextDate.getDate() + interval);
                
                currentCard.interval = interval;
                currentCard.repetitions = repetitions;
                currentCard.easeFactor = easeFactor;
                currentCard.nextReview = nextDate.toISOString().split('T')[0];

                await logic.saveToDB();
                logic.prepareStudy();
            },

            prepareStudy: () => {
                const today = new Date().toISOString().split('T')[0];
                const dueCards = cards.filter(c => c.nextReview <= today);
                if (dueCards.length > 0) {
                    currentCard = dueCards[0];
                    document.getElementById('study-content').style.display = 'block';
                    document.getElementById('no-study').style.display = 'none';
                    document.getElementById('rating-btns').style.display = 'none';
                    document.getElementById('guide-text').style.display = 'block';
                    document.getElementById('card-text').innerHTML = `<div class="front">${currentCard.front}</div>`;
                } else {
                    document.getElementById('study-content').style.display = 'none';
                    document.getElementById('no-study').style.display = 'block';
                }
            }
        };

        ui.renderList = () => {
            const listArea = document.getElementById('card-list-area');
            listArea.innerHTML = '';
            [...cards].reverse().forEach(card => {
                const div = document.createElement('div');
                div.className = 'card-item';
                div.innerHTML = `<div class="card-info"><div class="card-front">${card.front}</div><div class="card-back">${card.back}</div></div><button class="del-btn" onclick="logic.deleteCard(${card.id})">ì‚­ì œ</button>`;
                listArea.appendChild(div);
            });
        };
        ui.updateStats = () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('due-count').innerText = cards.filter(c => c.nextReview <= today).length;
            document.getElementById('total-count').innerText = cards.length;
        };

        logic.loadCards();
    </script>
</body>
</html>
